<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8">
  <title>Menu</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f4f4f4;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 13px;
      color: #666;
      margin-bottom: 12px;
    }

    .tabs {
      display: flex;
      overflow-x: auto;
      gap: 8px;
      margin-bottom: 12px;
    }

    .tab {
      flex-shrink: 0;
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      background: #e0e0e0;
    }

    .tab.active {
      background: #222;
      color: #fff;
      font-weight: 600;
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .info {
      max-width: 65%;
    }

    .title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .desc {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
    }

    .price {
      font-size: 14px;
      font-weight: 700;
      color: #e53935;
    }

    .qty-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .qty-btn {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      font-size: 18px;
      line-height: 1;
      cursor: pointer;
      background: #f0f0f0;
    }

    .qty {
      font-size: 15px;
      min-width: 24px;
      text-align: center;
    }

    .cards-container {
      padding-bottom: 90px; /* –º–µ—Å—Ç–æ –¥–ª—è –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏ */
    }

    .bottom {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 16px calc(10px + env(safe-area-inset-bottom));
      background: #ffffff;
      box-shadow: 0 -2px 8px rgba(0,0,0,.08);
    }

    .total {
      font-size: 14px;
      margin-bottom: 6px;
    }

    .btn-order {
      width: 100%;
      padding: 12px;
      border-radius: 14px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      background: #222;
      color: #fff;
    }

    .btn-order:disabled {
      opacity: 0.4;
      cursor: default;
    }
  </style>
</head>
<body>

  <h1>–ö–∞—Ç–∞–ª–æ–≥</h1>
  <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ —Ç–æ–≤–∞—Ä–∞</div>

  <!-- –í–ö–õ–ê–î–ö–ò-–ö–ê–¢–ï–ì–û–†–ò–ò -->
  <div class="tabs">
    <button class="tab active" data-cat="detergents">üßº –ú–æ—é—â–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞</button>
    <button class="tab" data-cat="plastic">üß¥ –ü–ª–∞—Å—Ç–º–∞—Å—Å–æ–≤—ã–µ –∏–∑–¥–µ–ª–∏–∏</button>
    <button class="tab" data-cat="chemicals">‚öóÔ∏è –•–∏–º–∏–∫–∞—Ç—ã</button>
    <button class="tab" data-cat="fragrances">üå∏ –û—Ç–¥—É—à–∫–∏</button>
  </div>

  <!-- –ö–ê–†–¢–û–ß–ö–ò –¢–û–í–ê–†–û–í -->
  <div id="cards" class="cards-container"></div>

  <!-- –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ -->
  <div class="bottom">
    <div class="total" id="total-text">Savatcha bo‚Äòsh</div>
    <button class="btn-order" id="order-btn" onclick="sendOrder()" disabled>Buyurtma berish</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // ==== –¢–û–í–ê–†–´ –ü–û –ö–ê–¢–ï–ì–û–†–ò–Ø–ú ====
    // –ú–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è / —Ü–µ–Ω—ã / –æ–ø–∏—Å–∞–Ω–∏—è –∫–∞–∫ —Ö–æ—á–µ—à—å
    const items = [
      // –ú–æ—é—â–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞
      {
        id: 1,
        category: "detergents",
        name: "–ì–µ–ª—å –¥–ª—è —Å—Ç–∏—Ä–∫–∏ ENEAR 1L",
        desc: "–î–ª—è —Ü–≤–µ—Ç–Ω–æ–≥–æ –∏ –±–µ–ª–æ–≥–æ –±–µ–ª—å—è",
        price: 45000
      },
      {
        id: 2,
        category: "detergents",
        name: "–°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è –ø–æ—Å—É–¥—ã Nalan 500ml",
        desc: "–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–¥–∞–ª—è–µ—Ç –∂–∏—Ä",
        price: 22000
      },
      {
        id: 3,
        category: "detergents",
        name: "–ü–æ—Ä–æ—à–æ–∫ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π 3kg",
        desc: "–î–ª—è —Ä—É—á–Ω–æ–π –∏ –º–∞—à–∏–Ω–Ω–æ–π —Å—Ç–∏—Ä–∫–∏",
        price: 65000
      },

      // –ü–ª–∞—Å—Ç–º–∞—Å—Å–æ–≤—ã–µ –∏–∑–¥–µ–ª–∏–∏
      {
        id: 10,
        category: "plastic",
        name: "–ü–ª–∞—Å—Ç–∏–∫–æ–≤–æ–µ –≤–µ–¥—Ä–æ 10L",
        desc: "–£–¥–æ–±–Ω–∞—è —Ä—É—á–∫–∞, –ø—Ä–æ—á–Ω—ã–π –ø–ª–∞—Å—Ç–∏–∫",
        price: 30000
      },
      {
        id: 11,
        category: "plastic",
        name: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è 5L",
        desc: "–î–ª—è –¥–æ–º–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞",
        price: 26000
      },

      // –•–∏–º–∏–∫–∞—Ç—ã
      {
        id: 20,
        category: "chemicals",
        name: "–§–æ—Å—Ñ–∞—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π",
        desc: "–î–ª—è –º–æ—é—â–∏—Ö —Ñ–æ—Ä–º—É–ª",
        price: 80000
      },
      {
        id: 21,
        category: "chemicals",
        name: "–ü–ê–í –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç",
        desc: "–û—Å–Ω–æ–≤–∞ –¥–ª—è –º–æ—é—â–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤",
        price: 120000
      },

      // –û—Ç–¥—É—à–∫–∏
      {
        id: 30,
        category: "fragrances",
        name: "–û—Ç–¥—É—à–∫–∞ 'Fresh Cotton'",
        desc: "–î–ª—è –≥–µ–ª—è –∏ –ø–æ—Ä–æ—à–∫–∞",
        price: 50000
      },
      {
        id: 31,
        category: "fragrances",
        name: "–û—Ç–¥—É—à–∫–∞ 'Citrus Clean'",
        desc: "–Ø—Ä–∫–∏–π —Å–≤–µ–∂–∏–π –∞—Ä–æ–º–∞—Ç",
        price: 52000
      }
    ];

    // –ö–æ–ª-–≤–æ –ø–æ id —Ç–æ–≤–∞—Ä–∞
    const quantities = {};
    items.forEach(i => quantities[i.id] = 0);

    let currentCategory = "detergents";

    const cardsContainer = document.getElementById("cards");
    const totalText = document.getElementById("total-text");
    const orderBtn = document.getElementById("order-btn");

    // –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    function renderCards() {
      cardsContainer.innerHTML = "";

      const filtered = items.filter(i => i.category === currentCategory);

      filtered.forEach(item => {
        const card = document.createElement("div");
        card.className = "card";

        const info = document.createElement("div");
        info.className = "info";

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = item.name;

        const desc = document.createElement("div");
        desc.className = "desc";
        desc.textContent = item.desc;

        const price = document.createElement("div");
        price.className = "price";
        price.textContent = item.price + " so'm";

        info.appendChild(title);
        info.appendChild(desc);
        info.appendChild(price);

        const qtyBox = document.createElement("div");
        qtyBox.className = "qty-box";

        const btnMinus = document.createElement("button");
        btnMinus.className = "qty-btn";
        btnMinus.textContent = "‚àí";
        btnMinus.onclick = () => changeQty(item.id, -1);

        const qty = document.createElement("div");
        qty.className = "qty";
        qty.id = "qty-" + item.id;
        qty.textContent = quantities[item.id];

        const btnPlus = document.createElement("button");
        btnPlus.className = "qty-btn";
        btnPlus.textContent = "+";
        btnPlus.onclick = () => changeQty(item.id, 1);

        qtyBox.appendChild(btnMinus);
        qtyBox.appendChild(qty);
        qtyBox.appendChild(btnPlus);

        card.appendChild(info);
        card.appendChild(qtyBox);

        cardsContainer.appendChild(card);
      });
    }

    function updateTotal() {
      let total = 0;
      let count = 0;

      items.forEach(i => {
        const q = quantities[i.id] || 0;
        total += i.price * q;
        count += q;
      });

      if (count === 0) {
        totalText.textContent = "Savatcha bo‚Äòsh";
        orderBtn.disabled = true;
      } else {
        totalText.textContent = `Jami: ${total} so'm (${count} ta pozitsiya)`;
        orderBtn.disabled = false;
      }

      return total;
    }

    function changeQty(id, delta) {
      quantities[id] = Math.max(0, (quantities[id] || 0) + delta);
      const qtyEl = document.getElementById("qty-" + id);
      if (qtyEl) {
        qtyEl.textContent = quantities[id];
      }
      updateTotal();
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");
        currentCategory = tab.getAttribute("data-cat");
        renderCards();
      });
    });

    function sendOrder() {
      const chosen = items
        .map(i => ({ ...i, qty: quantities[i.id] || 0 }))
        .filter(i => i.qty > 0);

      if (!chosen.length) return;

      const total = updateTotal();

      const payload = {
        items: chosen.map(i => ({
          id: i.id,
          name: i.name,
          price: i.price,
          qty: i.qty,
          category: i.category
        })),
        total: total
      };

      tg.sendData(JSON.stringify(payload));
      tg.close();
    }

    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
    window.sendOrder = sendOrder;

    // –ü–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
    renderCards();
    updateTotal();
  </script>
</body>
</html>
